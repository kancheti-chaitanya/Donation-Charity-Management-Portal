<div class="donation-details-container">
  <button mat-icon-button (click)="goBack()" class="back-button">
    <mat-icon>arrow_back</mat-icon>
  </button>

  <div *ngIf="loading" class="loading">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <div *ngIf="!loading && donation" class="details-content" @fadeIn>
    <mat-card class="donation-card">
      <mat-card-header>
        <mat-card-title>{{ donation.donation_type }}</mat-card-title>
        <mat-card-subtitle>Posted by: {{ donation.ngo_name }}</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="info-section">
          <h3>Donation Details</h3>
          <div class="info-row">
            <span class="label">Type:</span>
            <span class="value">{{ donation.donation_type }}</span>
          </div>
          <div class="info-row">
            <span class="label">Quantity/Amount:</span>
            <span class="value">{{ donation.quantity_or_amount }}</span>
          </div>
          <div class="info-row">
            <span class="label">Location:</span>
            <span class="value">{{ donation.location }}</span>
          </div>
          <div class="info-row">
            <span class="label">Pickup Date & Time:</span>
            <span class="value">{{ donation.pickup_date_time | date: 'full' }}</span>
          </div>
          <div class="info-row">
            <span class="label">Contact:</span>
            <span class="value">{{ donation.contact_info }}</span>
          </div>
        </div>

        <div class="status-section">
          <mat-chip-set aria-label="Status">
            <mat-chip [highlighted]="donation.priority === 'Urgent'">
              {{ donation.priority }}
            </mat-chip>
            <mat-chip>{{ donation.status }}</mat-chip>
          </mat-chip-set>
        </div>

        <div *ngIf="donation.images" class="images-section">
          <h3>Images</h3>
          <img [src]="donation.images" alt="Donation image" class="donation-image" />
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button
          mat-raised-button
          color="primary"
          (click)="toggleContributeForm()"
          *ngIf="currentUser?.role === 'Donor'"
        >
          {{ showContributeForm ? 'Cancel' : 'Contribute' }}
        </button>
        <button mat-raised-button disabled *ngIf="currentUser?.role !== 'Donor'">
          Login as Donor to Contribute
        </button>
      </mat-card-actions>
    </mat-card>

    <div *ngIf="showContributeForm" class="contribute-form" @slideUp>
      <mat-card>
        <mat-card-header>
          <mat-card-title>Make a Contribution</mat-card-title>
        </mat-card-header>

        <mat-card-content>
          <mat-form-field appearance="fill" class="form-field">
            <mat-label>Amount</mat-label>
            <input
              matInput
              type="number"
              [(ngModel)]="contributionAmount"
              placeholder="Enter amount"
            />
          </mat-form-field>

          <mat-form-field appearance="fill" class="form-field">
            <mat-label>Notes (Optional)</mat-label>
            <textarea
              matInput
              [(ngModel)]="contributionNotes"
              placeholder="Add any instructions or notes"
              rows="4"
            ></textarea>
          </mat-form-field>
        </mat-card-content>

        <mat-card-actions>
          <button
            mat-raised-button
            color="primary"
            (click)="submitContribution()"
            [disabled]="submitting"
          >
            {{ submitting ? 'Processing...' : 'Confirm & Schedule Pickup' }}
          </button>
          <button mat-stroked-button (click)="toggleContributeForm()">Cancel</button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>
