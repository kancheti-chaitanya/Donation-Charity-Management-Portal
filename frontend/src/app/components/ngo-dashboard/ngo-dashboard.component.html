<div class="ngo-dashboard-container">
  <mat-toolbar color="primary" class="header">
    <h1>NGO Dashboard</h1>
    <span class="spacer"></span>
    <button mat-raised-button (click)="toggleCreateForm()" class="create-btn">
      <mat-icon>add</mat-icon> New Donation Request
    </button>
  </mat-toolbar>

  <div class="dashboard-content">
    <div *ngIf="showCreateForm" class="create-form-section" @slideDown>
      <mat-card>
        <mat-card-header>
          <mat-card-title>Create Donation Request</mat-card-title>
        </mat-card-header>

        <mat-card-content>
          <form [formGroup]="form" (ngSubmit)="onCreateSubmit()">
            <mat-form-field appearance="fill" class="form-field">
              <mat-label>Donation Type</mat-label>
              <mat-select formControlName="donationType">
                <mat-option *ngFor="let type of types" [value]="type">{{ type }}</mat-option>
              </mat-select>
              <mat-error *ngIf="f['donationType'].hasError('required')">Type is required</mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill" class="form-field">
              <mat-label>Quantity/Amount</mat-label>
              <input matInput type="number" formControlName="quantity" />
              <mat-error *ngIf="f['quantity'].hasError('required')">Quantity is required</mat-error>
              <mat-error *ngIf="f['quantity'].hasError('min')">Quantity must be greater than 0</mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill" class="form-field">
              <mat-label>Location</mat-label>
              <input matInput formControlName="location" />
              <mat-error *ngIf="f['location'].hasError('required')">Location is required</mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill" class="form-field">
              <mat-label>Pickup Date & Time</mat-label>
              <input matInput type="datetime-local" formControlName="pickupDateTime" />
              <mat-error *ngIf="f['pickupDateTime'].hasError('required')">Date & time is required</mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill" class="form-field">
              <mat-label>Priority</mat-label>
              <mat-select formControlName="priority">
                <mat-option value="Normal">Normal</mat-option>
                <mat-option value="Urgent">Urgent</mat-option>
              </mat-select>
            </mat-form-field>

            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="submitting"
              class="submit-btn"
            >
              {{ submitting ? 'Creating...' : 'Create Request' }}
            </button>
          </form>
        </mat-card-content>
      </mat-card>
    </div>

    <div *ngIf="loading" class="loading">
      <mat-spinner diameter="50"></mat-spinner>
    </div>

    <div *ngIf="!loading && donations.length === 0" class="no-data">
      <mat-icon>inbox</mat-icon>
      <p>No donation requests yet</p>
    </div>

    <div class="donations-table">
      <table mat-table [dataSource]="donations" *ngIf="!loading && donations.length > 0">
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef>Type</th>
          <td mat-cell *matCellDef="let element">{{ element.donation_type }}</td>
        </ng-container>

        <ng-container matColumnDef="quantity">
          <th mat-header-cell *matHeaderCellDef>Quantity</th>
          <td mat-cell *matCellDef="let element">{{ element.quantity_or_amount }}</td>
        </ng-container>

        <ng-container matColumnDef="location">
          <th mat-header-cell *matHeaderCellDef>Location</th>
          <td mat-cell *matCellDef="let element">{{ element.location }}</td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let element">
            <mat-chip [highlighted]="element.status === 'Confirmed'">
              {{ element.status }}
            </mat-chip>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let element">
            <button mat-icon-button matTooltip="Edit" (click)="editDonation(element)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button matTooltip="Delete" (click)="deleteDonation(element.id)">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="['type', 'quantity', 'location', 'status', 'actions']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['type', 'quantity', 'location', 'status', 'actions'];"></tr>
      </table>
    </div>
  </div>
</div>
